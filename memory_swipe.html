<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∏—Ä –ö–∞–ø–∏–±–∞—Ä—ã</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS —á–µ—Ä–µ–∑ CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Telegram Web App API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Firebase-related global variables provided by the environment
        const firebaseConfig = {
  apiKey: "AIzaSyDQXqft_-EFfA58xUuhKKbCl8HnNx00ihg",
  authDomain: "memory-swipe.firebaseapp.com",
  databaseURL: "https://memory-swipe-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "memory-swipe",
  storageBucket: "memory-swipe.firebasestorage.app",
  messagingSenderId: "800130343271",
  appId: "1:800130343271:web:1468523f03220434890fc2",
  measurementId: "G-MXWK0B1ZVY"
};

const appId = firebaseConfig.appId;
        const initialAuthToken = null;

        let db = null;
        let auth = null;
        let userId = null;
        let userName = null;
        let isAuthReady = false;
        let chatInstance = null;
        let chatType = null;

        async function setupFirebase() {
            try {
                // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Firestore
                setLogLevel('debug');

                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ chat_instance –∏ chat_type, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–∞—Ö
                if (window.Telegram && Telegram.WebApp.initDataUnsafe.chat_instance) {
                    chatInstance = Telegram.WebApp.initDataUnsafe.chat_instance;
                }
                if (window.Telegram && Telegram.WebApp.initDataUnsafe.chat && Telegram.WebApp.initDataUnsafe.chat.type) {
                    chatType = Telegram.WebApp.initDataUnsafe.chat.type;
                }

                // –î–µ–ª–∞–µ–º Firebase –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
                window.db = db;
                window.auth = auth;
                window.getDoc = getDoc;
                window.setDoc = setDoc;
                window.doc = doc;
                window.appId = appId;
                window.getUserId = () => userId;
                window.getUserName = () => userName;
                window.isAuthReady = () => isAuthReady;
                window.getChatInstance = () => chatInstance;

                // –õ–æ–≥–∏—Ä—É–µ–º chat_instance –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                console.log(`Chat Instance: ${chatInstance || '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}`);
                console.log(`Chat Type: ${chatType || '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}`);

                // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–º–æ—â—å—é –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∏–ª–∏ –∞–Ω–æ–Ω–∏–º–Ω–æ
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // –û–∂–∏–¥–∞–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
                        if (window.Telegram && Telegram.WebApp.initDataUnsafe.user) {
                            const telegramUser = Telegram.WebApp.initDataUnsafe.user;
                            userName = telegramUser.username || telegramUser.first_name + (telegramUser.last_name ? ` ${telegramUser.last_name}` : '');
                        } else {
                            userName = userId.slice(0, 0); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π ID –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–ø–∞—Å–Ω–æ–≥–æ –∏–º–µ–Ω–∏
                        }

                        isAuthReady = true;
                        console.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —Å ID: ${userId}`);
                        document.getElementById('user-id-display').textContent = `ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userName}`;
                        await loadHighScore();
                    } else {
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª
                        userId = null;
                        userName = "–ê–Ω–æ–Ω–∏–º–Ω—ã–π";
                        isAuthReady = true;
                        document.getElementById('user-id-display').textContent = `ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –ê–Ω–æ–Ω–∏–º–Ω—ã–π`;
                        console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω.");
                    }
                });

            } catch (error) {
                console.error("–°–±–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Firebase:", error);
            }
        }

        window.loadHighScore = async () => {
            if (!window.isAuthReady() || !window.getUserId()) {
                console.warn("–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–∞, –ø—Ä–æ–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ—Ä–¥–∞.");
                return 0;
            }
            if (!window.db) {
                console.error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Firestore –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∫–æ—Ä–¥.");
                return 0;
            }
            try {
                const docRef = window.doc(window.db, `artifacts/${window.appId}/users/${window.getUserId()}/high_scores/capybara_feast`);
                const docSnap = await window.getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    window.highScore = data.score;
                    console.log("–†–µ–∫–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω:", window.highScore);
                    document.getElementById('high-score-display').textContent = `–†–µ–∫–æ—Ä–¥: ${window.highScore}`;
                    return data.score;
                } else {
                    window.highScore = 0;
                    console.log("–†–µ–∫–æ—Ä–¥ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω.");
                    return 0;
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ—Ä–¥–∞:", error);
                return 0;
            }
        };

        window.saveHighScore = async (score) => {
            if (!window.isAuthReady() || !window.getUserId()) {
                console.error("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –≥–æ—Ç–æ–≤–∞ –∏–ª–∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.");
                return;
            }
            if (!window.db) {
                console.error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Firestore –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥.");
                return;
            }
            try {
                const docRef = window.doc(window.db, `artifacts/${window.appId}/users/${window.getUserId()}/high_scores/capybara_feast`);
                await window.setDoc(docRef, { score: score }, { merge: true });
                console.log("–†–µ–∫–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω.");
                window.highScore = score;
                document.getElementById('high-score-display').textContent = `–†–µ–∫–æ—Ä–¥: ${window.highScore}`;
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞:", error);
            }
        };

        window.saveLeaderboardScore = async (score) => {
            if (!window.isAuthReady() || !window.getUserId()) {
                console.error("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–∫–æ—Ä–¥. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –≥–æ—Ç–æ–≤–∞ –∏–ª–∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.");
                return;
            }
            if (!window.db) {
                console.error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Firestore –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥.");
                return;
            }

            try {
                const userLeaderboardData = {
                    score: score,
                    userId: window.getUserId(),
                    userName: window.getUserName(),
                    timestamp: new Date()
                };

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
                const globalDocRef = doc(window.db, `artifacts/${window.appId}/public/data/global_scores`, window.getUserId());
                await setDoc(globalDocRef, userLeaderboardData, { merge: true });
                console.log("–ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–∫–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω.");

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤ —á–∞—Ç–∞, –µ—Å–ª–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä —á–∞—Ç–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                const chatInstance = window.getChatInstance();
                if (chatInstance) {
                    try {
                        const chatDocRef = doc(window.db, `artifacts/${window.appId}/public/data/chat_leaderboards/${chatInstance}/scores`, window.getUserId());
                        await setDoc(chatDocRef, userLeaderboardData, { merge: true });
                        console.log("–†–µ–∫–æ—Ä–¥ —á–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω.");
                    } catch (error) {
                        console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞ —á–∞—Ç–∞. –í–æ–∑–º–æ–∂–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞:", error);
                    }
                } else {
                    console.warn("–≠–∫–∑–µ–º–ø–ª—è—Ä —á–∞—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–ø—É—Å–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤ —á–∞—Ç–∞.");
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤:", error);
            }
        };

        window.fetchLeaderboard = async (isGlobal) => {
            if (!window.db) {
                console.error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Firestore –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤.");
                return [];
            }
            const chatInstance = window.getChatInstance();
            if (!isGlobal && !chatInstance) {
                console.warn("–ù–µ –≤ –≥—Ä—É–ø–ø–æ–≤–æ–º —á–∞—Ç–µ, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤ —á–∞—Ç–∞.");
                return null; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º null, —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
            }
            try {
                const collectionPath = isGlobal ? `artifacts/${window.appId}/public/data/global_scores` : `artifacts/${window.appId}/public/data/chat_leaderboards/${chatInstance}/scores`;
                const q = query(
                    collection(window.db, collectionPath),
                    orderBy('score', 'desc'),
                    limit(100)
                );
                const querySnapshot = await getDocs(q);
                const leaderboard = [];
                querySnapshot.forEach((doc) => {
                    leaderboard.push(doc.data());
                });
                return leaderboard;
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤:", error);
                return [];
            }
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const gameContainer = document.getElementById('game-container');
        const scoreDisplay = document.getElementById('score-display');
        const timerDisplay = document.getElementById('timer-display');
        const cardDisplay = document.getElementById('card-display');
        const leftButton = document.getElementById('left-button');
        const rightButton = document.getElementById('right-button');
        const overlay = document.getElementById('overlay');
        const overlayText = document.getElementById('overlay-text');
        const overlaySubtext = document.getElementById('overlay-subtext');
        const startButton = document.getElementById('start-button');
        const chatLeaderboardButton = document.getElementById('chat-leaderboard-button');
        const globalLeaderboardButton = document.getElementById('global-leaderboard-button');
        const donateButton = document.getElementById('donate-button');
        const leaderboardModal = document.getElementById('leaderboard-modal');
        const leaderboardTitle = document.getElementById('leaderboard-title');
        const closeLeaderboardButton = document.getElementById('close-leaderboard');
        const leaderboardList = document.getElementById('leaderboard-list');
        const effectContainer = document.getElementById('effect-container');
        const backgroundMusic = document.getElementById('background-music');
        const muteButton = document.getElementById('mute-button');
        const highScoreDisplay = document.getElementById('high-score-display');
        const highScoreMessage = document.getElementById('high-score-message');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');
        const messageCloseButton = document.getElementById('message-close-button');


        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let score = 0;
        let highScore = 0;
        let gameActive = false;
        let timeRemaining = 5.0;
        let timerInterval = null;
        let timeout = null;
        let seenCards = [];
        let currentCard = null;
        let isRepeated = false;
        let lastAnswerTime = performance.now();
        let isMuted = false;
        let roundCount = 0;
        let isInedible = false;

        // –≠–º–æ–¥–∑–∏ –¥–ª—è –∏–≥—Ä—ã (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
        const emojis = ['üçá', 'üçâ', 'üçä', 'üçã', 'üçå', 'üçç', 'üçé', 'üçê', 'ü•ù', 'ü•≠', 'üçí', 'üçì', 'ü•ë', 'ü•ï', 'ü•î', 'üå∂Ô∏è', 'üåΩ', 'ü•ú', 'üçî', 'üçï', 'üå≠', 'üåÆ', 'üåØ', 'ü•ô', 'ü•™', 'üçü', 'üßÄ', 'üçñ', 'üçó', 'üç§', 'üç£', 'üçô', 'üçö', 'üçú', 'üç≤', 'üçù', 'ü•ó', 'üçø', 'üç©', 'üç™', 'üéÇ', 'üç∞', 'üç´', 'üç¨', 'üç≠', 'üçÆ', 'üçØ', 'üçº', '‚òï', 'üçµ', 'üç∂', 'ü•§', 'üßä', 'ü•ê', 'üçû', 'ü•ñ', 'ü•®', 'ü•û', 'üßá', 'üç≥', 'ü•ì', 'ü•©', 'üçó', 'ü¶™', 'ü¶û', 'ü¶ê', 'ü¶Ä', 'ü¶ë', 'üêô', 'üçô', 'üç£', 'üç§', 'üçö', 'üçõ', 'üçú', 'üç≤', 'ü•ò', 'üç¢', 'üç°', 'üçß', 'üç®', 'üç¶', 'ü•ß', 'üçÆ', 'üç∞', 'üéÇ', 'üßÅ', 'üç©', 'üç™', 'üç´', 'üç¨', 'üç≠', 'üçØ'];

        // –≠–º–æ–¥–∑–∏ –¥–ª—è –Ω–µ—Å—ä–µ–¥–æ–±–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        const inedibleEmojis = ['üëü', 'üß¶', 'üíç', 'üíé', 'üî®', 'üìñ', 'üöó', 'üîë', 'üîã', '‚öΩ'];

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–µ—Ä–∞
        const timeLimit = 5000;
        const timerUpdateInterval = 250;

        function setupEventListeners() {
            startButton.addEventListener('click', startGame);
            muteButton.addEventListener('click', () => {
                if (backgroundMusic.paused) {
                    backgroundMusic.play().catch(e => console.error("–°–±–æ–π –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:", e));
                    muteButton.textContent = 'üîä';
                    isMuted = false;
                } else {
                    backgroundMusic.pause();
                    muteButton.textContent = 'üîá';
                    isMuted = true;
                }
            });
            chatLeaderboardButton.addEventListener('click', async () => {
                leaderboardTitle.textContent = '–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ —á–∞—Ç–∞';
                leaderboardModal.classList.remove('hidden');
                const chatInstance = window.getChatInstance();
                if (!chatInstance) {
                    leaderboardList.innerHTML = '<p class="text-center text-gray-500">–≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–∞—Ö.</p>';
                    return;
                }
                leaderboardList.innerHTML = '<p class="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
                const scores = await window.fetchLeaderboard(false);
                displayLeaderboard(scores);
            });
            globalLeaderboardButton.addEventListener('click', async () => {
                leaderboardTitle.textContent = '–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤';
                leaderboardModal.classList.remove('hidden');
                leaderboardList.innerHTML = '<p class="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
                const scores = await window.fetchLeaderboard(true);
                displayLeaderboard(scores);
            });
            closeLeaderboardButton.addEventListener('click', () => {
                leaderboardModal.classList.add('hidden');
            });

            // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è
            donateButton.addEventListener('click', () => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ Telegram Web Apps `showInvoice`
                if (window.Telegram && Telegram.WebApp.isVersionAtLeast('6.9')) {
                    // –ü–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –º—ã –Ω–µ –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π —Å—á–µ—Ç.
                    // –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ.
                    showMessage('–ß—Ç–æ–±—ã –ø–æ–∫–æ—Ä–º–∏—Ç—å –ö–∞–ø–∏–±–∞—Ä—É –∑–≤—ë–∑–¥–∞–º–∏, –Ω—É–∂–µ–Ω –Ω–∞—Å—Ç–æ—è—â–∏–π —Å–µ—Ä–≤–µ—Ä. –≠—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è!');
                } else {
                    console.warn("–í–µ—Ä—Å–∏—è Telegram Web App —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä–∞—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ showInvoice.");
                    // –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
                    showMessage('–§—É–Ω–∫—Ü–∏—è –æ–ø–ª–∞—Ç—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–µ–π –≤–µ—Ä—Å–∏–µ–π Telegram. –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.');
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            messageCloseButton.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });


            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–≤–æ–¥–∞
            document.addEventListener('keydown', (e) => {
                if (!gameActive) return;
                if (e.key === 'ArrowLeft') handleInput('left');
                if (e.key === 'ArrowRight') handleInput('right');
            });
            leftButton.addEventListener('click', () => { if (gameActive) handleInput('left'); });
            rightButton.addEventListener('click', () => { if (gameActive) handleInput('right'); });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
            let touchstartX = 0;
            let isDragging = false;

            // –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            gameContainer.addEventListener('touchstart', e => {
                if (!gameActive) return;
                touchstartX = e.changedTouches[0].screenX;
                isDragging = true;
                cardDisplay.style.transition = 'none'; // –û—Ç–∫–ª—é—á–∞–µ–º CSS-–ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            }, false);

            // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            gameContainer.addEventListener('touchmove', e => {
                if (!gameActive || !isDragging) return;
                const currentX = e.changedTouches[0].screenX;
                const deltaX = currentX - touchstartX;
                const maxMove = 100;
                const move = Math.max(-maxMove, Math.min(maxMove, deltaX));
                const rotate = move / 10;
                cardDisplay.style.transform = `translateX(${move}px) rotate(${rotate}deg)`;
            }, false);

            // –ö–æ–Ω–µ—Ü –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            gameContainer.addEventListener('touchend', e => {
                if (!gameActive || !isDragging) return;
                isDragging = false;

                const touchendX = e.changedTouches[0].screenX;

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—ã–ª –ª–∏ —Å–≤–∞–π–ø –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º
                if (touchendX < touchstartX - 50) handleInput('left', touchendX);
                else if (touchendX > touchstartX + 50) handleInput('right', touchendX);
                else {
                    // –ï—Å–ª–∏ —Å–≤–∞–π–ø –±—ã–ª —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–º, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
                    cardDisplay.style.transition = 'transform 0.2s ease-in-out';
                    cardDisplay.style.transform = '';
                }
            }, false);
        }

        function displayLeaderboard(scores) {
            leaderboardList.innerHTML = '';
            if (scores === null) {
                 return;
            }
            if (scores.length === 0) {
                leaderboardList.innerHTML = '<p class="text-center text-gray-500">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>';
                return;
            }
            scores.forEach((item, index) => {
                const listItem = document.createElement('li');
                listItem.classList.add('flex', 'justify-between', 'items-center', 'bg-gray-100', 'p-3', 'rounded-xl', 'shadow-sm');

                const rankText = document.createElement('span');
                rankText.classList.add('text-lg', 'font-bold', 'text-gray-600');
                rankText.textContent = `${index + 1}.`;

                const userNameDisplay = item.userName || item.userId;
                const userText = document.createElement('span');
                userText.classList.add('text-sm', 'font-mono', 'text-gray-500', 'truncate');
                userText.textContent = userNameDisplay;

                const scoreText = document.createElement('span');
                scoreText.classList.add('text-xl', 'font-bold', 'text-blue-600');
                scoreText.textContent = item.score;

                listItem.appendChild(rankText);
                listItem.appendChild(userText);
                listItem.appendChild(scoreText);
                leaderboardList.appendChild(listItem);
            });
        }

        // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ MainButton
        if (window.Telegram && Telegram.WebApp.MainButton) {
            Telegram.WebApp.MainButton.setText("–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—á–µ—Ç–æ–º");
            Telegram.WebApp.MainButton.onClick(function() {
                const shareMessage = `–Ø –Ω–∞–±—Ä–∞–ª ${highScore} –æ—á–∫–æ–≤ –≤ –∏–≥—Ä–µ "–ü–∏—Ä –ö–∞–ø–∏–±–∞—Ä—ã"! –ü–æ–ø—Ä–æ–±—É–µ—à—å –ø–æ–±–∏—Ç—å –º–æ–π —Ä–µ–∫–æ—Ä–¥?`;
                const shareUrl = `https://t.me/memoryswipebot/start`;
                Telegram.WebApp.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareMessage)}`);
            });
            Telegram.WebApp.MainButton.hide();
        }

        // –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        function showMessage(text) {
            messageText.textContent = text;
            messageBox.classList.remove('hidden');
        }

        // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
        function startGame() {
            score = 0;
            seenCards = [];
            roundCount = 0;
            gameActive = true;
            isInedible = false;
            overlay.classList.add('opacity-0', 'pointer-events-none');
            highScoreMessage.classList.add('opacity-0');
            donateButton.classList.remove('hidden'); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã
            updateScore();
            if (!isMuted) {
                backgroundMusic.play().catch(error => {
                    console.error("–°–±–æ–π –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:", error);
                });
            }
            if (window.Telegram && Telegram.WebApp.MainButton) {
                Telegram.WebApp.MainButton.hide();
            }
            gameLoop();
        }

        async function endGame(reason) {
            gameActive = false;
            clearInterval(timerInterval);
            clearTimeout(timeout);
            overlayText.textContent = reason;
            overlaySubtext.innerHTML = `–í–∞—à —Å—á–µ—Ç: <span class="font-bold text-blue-600">${score}</span> –æ—á–∫–æ–≤.`;
            startButton.textContent = '–ü–æ–∫–æ—Ä–º–∏—Ç—å –µ—â–µ —Ä–∞–∑';
            overlay.classList.remove('opacity-0', 'pointer-events-none');
            donateButton.classList.remove('hidden'); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –∏–≥—Ä—ã

            if (score > window.highScore) {
                highScore = score;
                highScoreDisplay.textContent = `–†–µ–∫–æ—Ä–¥: ${highScore}`;
                highScoreMessage.classList.remove('opacity-0');
                if (window.isAuthReady() && window.getUserId()) {
                    await window.saveHighScore(highScore);
                    await window.saveLeaderboardScore(highScore);
                }
            } else {
                highScore = window.highScore;
            }

            if (window.Telegram && Telegram.WebApp.MainButton) {
                Telegram.WebApp.MainButton.show();
            }
        }

        function createPositiveEffect() {
            const particleCount = 10;
            const particles = ['‚≠ê', '‚ú®', 'üåü', 'üí´', 'üåà'];
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                particle.classList.add('particle', 'text-4xl');

                const randomX = (Math.random() - 0.5) * 200;
                const randomY = (Math.random() - 0.5) * 200;
                const duration = 0.8 + Math.random() * 0.4;
                const animationClass = ['star-burst-small', 'star-burst-medium', 'star-burst-large'][Math.floor(Math.random() * 3)];

                particle.style.setProperty('--x', `${randomX}px`);
                particle.style.setProperty('--y', `${randomY}px`);
                particle.style.animation = `${animationClass} ${duration}s ease-out forwards`;

                effectContainer.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, duration * 1000);
            }
        }

        function handleInput(direction) {
            let correct = false;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å
            if (isInedible) {
                if (direction === 'right') {
                    correct = true;
                } else {
                    endGame('–≠—Ç–æ –Ω–µ—Å—ä–µ–¥–æ–±–Ω–æ!');
                    return;
                }
            } else if (direction === 'left' && !isRepeated) {
                correct = true;
            } else if (direction === 'right' && isRepeated) {
                correct = true;
            }

            if (correct) {
                if (window.Telegram && Telegram.WebApp.HapticFeedback) {
                    Telegram.WebApp.HapticFeedback.impactOccurred('light');
                }

                const timeTaken = performance.now() - lastAnswerTime;

                let points;
                const gracePeriod = 300;
                const maxPoints = Math.floor(timeLimit / 5);

                if (timeTaken <= gracePeriod) {
                    points = maxPoints;
                } else {
                    const timeRemaining = Math.max(0, timeLimit - timeTaken);
                    points = Math.floor(timeRemaining / 5);
                }

                score += points;

                updateScore();
                createPositiveEffect();

                // –ê–Ω–∏–º–∏—Ä—É–µ–º —É—Ö–æ–¥ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                cardDisplay.style.transition = 'none';
                if (direction === 'left') {
                    let endX, endY, endRotate;
                    endX = -window.innerWidth * 1.5;
                    endY = window.innerHeight * 1.5;
                    endRotate = -45;
                    cardDisplay.style.setProperty('--end-x', `${endX}px`);
                    cardDisplay.style.setProperty('--end-y', `${endY}px`);
                    cardDisplay.style.setProperty('--end-rotate', `${endRotate}deg`);
                    cardDisplay.classList.add('card-animate-out-left');
                    setTimeout(() => {
                        cardDisplay.classList.remove('card-animate-out-left');
                        gameLoop();
                    }, 200);
                } else { // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ –∏–ª–∏ —Å–≤–∞–π–ø –Ω–µ—Å—ä–µ–¥–æ–±–Ω–æ–≥–æ
                    cardDisplay.classList.add('card-animate-out-right');
                    setTimeout(() => {
                        cardDisplay.classList.remove('card-animate-out-right');
                        gameLoop();
                    }, 200);
                }

                roundCount++;
                isInedible = false;

            } else {
                if (window.Telegram && Telegram.WebApp.HapticFeedback) {
                    Telegram.WebApp.HapticFeedback.notificationOccurred('error');
                }

                // –ê–Ω–∏–º–∞—Ü–∏—è —à–∞—Ç–∞–Ω–∏—è –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ
                cardDisplay.classList.add('card-wobble');
                setTimeout(() => {
                    cardDisplay.classList.remove('card-wobble');
                }, 500);

                let reason = '';
                if (direction === 'left' && isRepeated) {
                    reason = '–Ø —ç—Ç–æ —É–∂–µ –µ–ª–∞!';
                } else if (direction === 'right' && !isRepeated) {
                    reason = '–≠–π! –Ø —ç—Ç–æ –µ—â–µ –Ω–µ –ø—Ä–æ–±–æ–≤–∞–ª–∞!';
                } else {
                    reason = '–ö–∞–ø–∏ —É—Å–Ω—É–ª–∞...';
                }

                setTimeout(() => {
                    endGame(reason);
                }, 150);
            }
        }

        function gameLoop() {
            if (!gameActive) return;

            clearInterval(timerInterval);
            clearTimeout(timeout);
            timeRemaining = 5.0;
            updateTimer();
            lastAnswerTime = performance.now();

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º —Ä–∞—É–Ω–¥–æ–º
            cardDisplay.style.transform = '';

            let newChance = 0.5;
            // –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å:
            if (roundCount < 5) {
                // –ü–µ—Ä–≤—ã–µ 5 —Ö–æ–¥–æ–≤: 80% —à–∞–Ω—Å –Ω–∞ –Ω–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç
                newChance = 0.8;
            } else {
                // –ü–æ—Å–ª–µ 5-–≥–æ —Ö–æ–¥–∞: 50% —à–∞–Ω—Å –Ω–∞ –Ω–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç
                newChance = 0.5;
            }

            // 10% —à–∞–Ω—Å –Ω–∞ –Ω–µ—Å—ä–µ–¥–æ–±–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –ø–æ—Å–ª–µ 30 —Ä–∞—É–Ω–¥–æ–≤
            const shouldBeInedible = roundCount >= 30 && Math.random() < 0.1;
            isInedible = shouldBeInedible;

            if (isInedible) {
                currentCard = inedibleEmojis[Math.floor(Math.random() * inedibleEmojis.length)];
                isRepeated = false;
            } else {
                const shouldRepeat = seenCards.length > 0 && Math.random() > newChance;
                isRepeated = shouldRepeat;

                if (shouldRepeat) {
                    currentCard = seenCards[Math.floor(Math.random() * seenCards.length)];
                } else {
                    const availableEmojis = emojis.filter(e => !seenCards.includes(e));
                    if (availableEmojis.length === 0) {
                        endGame('–ö–∞–ø–∏ –Ω–∞–µ–ª–∞—Å—å!');
                        return;
                    }
                    currentCard = availableEmojis[Math.floor(Math.random() * availableEmojis.length)];
                    seenCards.push(currentCard);
                }
            }

            cardDisplay.textContent = currentCard;
            cardDisplay.classList.add('card-animate-in');
            setTimeout(() => {
                cardDisplay.classList.remove('card-animate-in');
            }, 170);

            let startTime = performance.now();
            timerInterval = setInterval(() => {
                const elapsedTime = performance.now() - startTime;
                timeRemaining = Math.max(0, 5 - (elapsedTime / 1000));
                updateTimer();
            }, timerUpdateInterval);

            timeout = setTimeout(() => {
                if (gameActive) {
                    endGame('–ö–∞–ø–∏ —É—Å–Ω—É–ª–∞...');
                }
            }, timeLimit);
        }

        function updateScore() {
            scoreDisplay.textContent = `–°—á–µ—Ç: ${score}`;
        }

        function updateTimer() {
            timerDisplay.textContent = timeRemaining.toFixed(1);
        }

        // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π. –ü–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ-–º–æ–¥—É–ª–µ,
        // –æ–Ω–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞. –í–µ—Å—å —Å–∫—Ä–∏–ø—Ç, –ø–æ —Å—É—Ç–∏, —è–≤–ª—è–µ—Ç—Å—è "–æ—Å–Ω–æ–≤–Ω—ã–º" –±–ª–æ–∫–æ–º.
        // –ú—ã –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
        // –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–æ –∏—Ö –≤—ã–∑–æ–≤–∞.
        setupFirebase();
        setupEventListeners();

    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ */
        @keyframes fly-in {
            from {
                transform: translate(100%, -100%) scale(0.5);
                opacity: 0;
            }
            to {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
        }

        .card-animate-in {
            animation: fly-in 0.17s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞, –∫–∞—Ä—Ç–æ—á–∫–∞ —É–ª–µ—Ç–∞–µ—Ç –≤–Ω–∏–∑ */
        @keyframes fly-out-down {
            from {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 1;
            }
            to {
                transform: translate(var(--end-x), var(--end-y)) scale(0.5) rotate(var(--end-rotate));
                opacity: 0;
            }
        }

        .card-animate-out-left {
            animation: fly-out-down 0.2s ease-in-out forwards;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–≤–∞–π–ø–∞ –≤–ø—Ä–∞–≤–æ (–≤–∑—Ä—ã–≤) */
        @keyframes burst-out-correct {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
                filter: blur(0px);
            }
            100% {
                transform: scale(2.5) rotate(720deg);
                opacity: 0;
                filter: blur(10px);
            }
        }

        .card-animate-out-right {
            animation: burst-out-correct 0.2s ease-in forwards;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —à–∞—Ç–∞–Ω–∏—è –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ */
        @keyframes wobble {
            0% { transform: translateX(0) rotate(0deg); }
            15% { transform: translateX(-10px) rotate(-5deg); }
            30% { transform: translateX(10px) rotate(5deg); }
            45% { transform: translateX(-10px) rotate(-5deg); }
            60% { transform: translateX(10px) rotate(5deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            90% { transform: translateX(5px) rotate(2deg); }
            100% { transform: translateX(0) rotate(0deg); }
        }

        .card-wobble {
            animation: wobble 0.5s ease-in-out;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü */
        @keyframes star-burst-small {
            from { transform: translate(0, 0) scale(0); opacity: 1; }
            to { transform: translate(var(--x), var(--y)) scale(1.5); opacity: 0; }
        }
        @keyframes star-burst-medium {
            from { transform: translate(0, 0) scale(0); opacity: 1; }
            to { transform: translate(var(--x), var(--y)) scale(1.2); opacity: 0; }
        }
        @keyframes star-burst-large {
            from { transform: translate(0, 0) scale(0); opacity: 1; }
            to { transform: translate(var(--x), var(--y)) scale(1.8); opacity: 0; }
        }

        .particle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            will-change: transform, opacity;
        }

        /* –ù–æ–≤–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º */
        #game-container {
            background-image: url('https://media.istockphoto.com/id/1160720443/vector/abstract-simple-geometric-vector-seamless-pattern-with-gold-line-texture-on-white-background.webp?b=1&s=612x612&w=0&k=20&c=ejtl-XXAFVsHcjNbaxdiT4xzzs5bGtA_CUYkO9ZQ-Jk=');
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body class="h-screen w-screen flex items-center justify-center bg-gray-100 p-2 sm:p-4">

<!-- –ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
<div id="game-container" class="w-full max-w-sm h-full max-h-[600px] flex flex-col justify-between items-center bg-white rounded-3xl shadow-2xl p-4 relative overflow-hidden">

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–æ –∑–≤—É–∫–æ–º, —Å—á–µ—Ç–æ–º –∏ —Ç–∞–π–º–µ—Ä–æ–º -->
    <div class="w-full flex justify-between items-start mb-4">
        <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞, —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–∞—è –∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è -->
        <button id="mute-button" class="bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-full shadow-md transition-colors duration-200 z-30">
            üîä
        </button>
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—á–µ—Ç–∞ –∏ —Ç–∞–π–º–µ—Ä–∞ -->
        <div class="flex flex-col items-end">
            <div id="score-display" class="text-xl sm:text-2xl font-bold text-gray-800">–°—á–µ—Ç: 0</div>
            <div id="timer-display" class="text-lg sm:text-xl font-bold text-red-500">5.0</div>
        </div>
    </div>

    <!-- –û–±–ª–∞—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    <div class="relative w-full h-full flex items-center justify-center my-4">
        <div id="card-display" class="text-9xl sm:text-[10rem]"></div>
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ -->
        <div id="effect-container" class="absolute inset-0 z-10 pointer-events-none"></div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="w-full flex justify-center space-x-2 mb-2">
        <button id="left-button" class="flex-1 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold py-3 rounded-full shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-100 text-sm">
            –ù–æ–≤—ã–π
        </button>
        <button id="right-button" class="flex-1 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold py-3 rounded-full shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-100 text-sm">
            –ü–æ–≤—Ç–æ—Ä
        </button>
    </div>

    <!-- –ù–∞–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞/–∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã -->
    <div id="overlay" class="absolute inset-0 bg-white/90 flex flex-col items-center justify-center text-center p-4 transition-opacity duration-300 z-20">
        <h2 id="overlay-text" class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-2">–ü–∏—Ä –ö–∞–ø–∏–±–∞—Ä—ã</h2>
        <p id="overlay-subtext" class="text-sm md:text-base text-gray-600 mb-4">–ü—Ä–æ–≤–µ–¥–∏ –≤–ª–µ–≤–æ, –µ—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤—ã–π —Ñ—Ä—É–∫—Ç, –≤–ø—Ä–∞–≤–æ ‚Äî –µ—Å–ª–∏ –æ–Ω —É–∂–µ –±—ã–ª.</p>
        <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞ –Ω–∞ –Ω–∞–ª–æ–∂–µ–Ω–∏–∏ -->
        <div id="high-score-container" class="text-center text-gray-700 mb-4">
            <p id="high-score-display" class="text-lg sm:text-xl font-bold mb-1">–†–µ–∫–æ—Ä–¥: 0</p>
            <p id="high-score-message" class="text-sm font-semibold text-green-600 opacity-0 transition-opacity duration-300">–ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!</p>
        </div>
        <button id="start-button" class="bg-blue-600 hover:bg-blue-700 text-white text-lg font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105">
            –ù–∞–∫–æ—Ä–º–∏—Ç—å –ö–∞–ø–∏
        </button>
        <div class="flex flex-col mt-3 space-y-2 w-full max-w-xs">
            <button id="chat-leaderboard-button" class="bg-gray-500 hover:bg-gray-600 text-white text-sm font-bold py-2 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105">
                –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ —á–∞—Ç–∞
            </button>
            <button id="global-leaderboard-button" class="bg-gray-500 hover:bg-gray-600 text-white text-sm font-bold py-2 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105">
                –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
            </button>
            <button id="donate-button" class="bg-yellow-400 hover:bg-yellow-500 text-white text-sm font-bold py-2 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105">
                –ü–æ–∫–æ—Ä–º–∏—Ç—å –ö–∞–ø–∏ –∑–≤–µ–∑–¥–∞–º–∏ ‚≠ê
            </button>
        </div>
        <p id="user-id-display" class="text-xs text-gray-400 mt-2"></p>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤ -->
    <div id="leaderboard-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-30">
        <div class="bg-white rounded-3xl shadow-2xl p-6 w-11/12 max-w-md max-h-[80%] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="leaderboard-title" class="text-2xl font-bold text-gray-800">–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h3>
                <button id="close-leaderboard" class="text-gray-500 hover:text-gray-700 text-3xl font-bold">&times;</button>
            </div>
            <div id="leaderboard-list-container" class="overflow-y-auto flex-grow pr-2">
                <ul id="leaderboard-list" class="space-y-2">
                    <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ JavaScript -->
                </ul>
            </div>
        </div>
    </div>

    <!-- –ö–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
    <div id="message-box" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-11/12 max-w-sm text-center">
            <p id="message-text" class="text-gray-800 font-semibold mb-4"></p>
            <button id="message-close-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full">OK</button>
        </div>
    </div>
</div>

<!-- –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ -->
<audio id="background-music" src="https://storage.googleapis.com/corpusant-app-public/riffs/4213a202-c6e6-4ab5-987e-6f8c4aeaedf9/audio/ce8a21ee-1f28-465e-b3da-598e2e43b702.m4a" loop></audio>

</body>
</html>
